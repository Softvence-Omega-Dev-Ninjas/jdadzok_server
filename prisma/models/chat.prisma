// -----------------------------------
// CHAT SYSTEM
// -----------------------------------

model Chat {
  id String @id @default(uuid())

  type ChatType @default(DIRECT)
  name String? // only for groups

  createdById String
  createdBy   User   @relation(fields: [createdById], references: [id])

  participants ChatParticipant[]
  messages     Message[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("chats")
}

model ChatParticipant {
  id String @id @default(uuid())

  chatId String
  chat   Chat   @relation(fields: [chatId], references: [id])

  userId String
  user   User   @relation(fields: [userId], references: [id])

  joinedAt  DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([chatId, userId])
  @@map("chat_participants")
}

model Message {
  id String @id @default(uuid())

  chatId String
  chat   Chat   @relation(fields: [chatId], references: [id])

  senderId String
  sender   User   @relation(fields: [senderId], references: [id])

  content   String?
  mediaUrl  String?
  mediaType MediaType?

  status MessageStatus @default(SENT)
  readBy MessageRead[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("messages")
}

model MessageRead {
  id String @id @default(uuid())

  messageId String
  message   Message @relation(fields: [messageId], references: [id])

  userId String
  user   User   @relation(fields: [userId], references: [id])

  readAt DateTime @default(now())

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([messageId, userId])
  @@map("message_reads")
}
